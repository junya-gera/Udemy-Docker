・Dockerコンテナの実行

  $ docker run hello-world
    順にdockerコマンド、サブコマンド、イメージの指定
    runは次の3つを1度に実行
      docker pull   →イメージの取得
      docker create →コンテナの作成
      docker start  →コンテナの起動
    
    イメージ名の後に何も書かなければlatestのイメージがダウンロードされる
    明示的にタグを記述する場合はdocker run hello-world:latestのようにコロンの後に書く

  16.whalesayコンテナの実行とDockerイメージダウンロードの動作

    $ docker run docker/whalesay cowsay Hello!!
      イメージ名がdocker/whalesay
      cowsay Hello!!はdocker/whalesayのコンテナ内で呼び出すコマンド
      イメージ名の後にコマンドを続けることでコンテナが立ち上がった際に実行できる
      cowsayはクジラのAAに好きな言葉を喋らせるコマンド



  17.ローカル上のDockerイメージの管理
    $ docker images
      → ローカル上にダウンロード済みのイメージ一覧を表示するコマンド

      REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
      hello-world         latest              bf756fb1ae65        4 months ago        13.3kB
      docker/whalesay     latest              6b362a9f73eb        5 years ago         247MB
      
    $ docker tag docker/whalesay my_whalesay
      →tag タグ付けするサブコマンド。元のイメージ名、新しいイメージ名の順に書く
      → my_whalesayでdocker/whalesayと全く同じ意味になる

    $ docker tag docker/whalesay my_whalesay:ver1
      → 新しいイメージ名にver1というタグ名をつける

    $ docker inspect my_whalesay
      → inspect イメージの詳細情報を表示するサブコマンド
      → 後ろに対象のイメージ名かイメージIDをつける

    $ docker -f rmi docker/whalesay
      → rmi ローカル上のイメージを削除するサブコマンド
      → もしそのイメージを使用して作られたコンテナがある場合は、
        まずそのコンテナを先に削除するか、強制削除する-fを付ける

    $ docker pull docker/whalesay
      → イメージを取得するサブコマンド。削除してもこれで戻せる
      → ちなみにlatestタグのものが必ず最新とは限らないので、タグは明示的に
        つけたほうがいい



  18.Dockerfileを利用したイメージビルド方法の解説
    Dockerfileとは、コンテナの構成情報を定義したファイル。
    Dockerfileからイメージを構築することをイメージビルドという

    $ mkdir imagebuild
    $ cd imagebuild/
    $ vim dockerfile
    $ FROM docker/whalesay:latest
      → FROM イメージを作成する際に、元になるイメージを指定する命令
    
    $ RUN apt-get -y update && apt-get install -y fortunes
      → RUN イメージビルドの際に実行するコマンドを指定するための命令
      → apt-get パッケージを操作・管理するコマンド
      → install 指定したパッケージをインストール(今回はfortunes)

    $ CMD /usr/games/fortune | cowsay
      → CMD コンテナが作成された後に実行するコマンドを指定する命令

    $ docker build -t docker-whale .
      → build イメージをビルドするサブコマンド
      → -t docker-whale タグ名の指定(今回はdocker-whaleという名前を付ける)
      → . ビルドコンテキストの指定
      → ビルドコンテキスト イメージを作成する際にアクセスできるディレクトリやファイルの
        範囲を示すもの。今回はカレントディレクトリの.
        このファイルはまとめてDockerデーモンに送られる。ファイルサイズが大きい場合、
        転送に時間がかかるので、余計なファイルは消しておく
    
  19.Dockerfileを使用したイメージビルドの実行
    $ docker build --no-cache -t docker-whale .
      → --no-cache すでにビルドしていてdockerfileの中身が同じであれば
        Using cacheが残っているので更新されない。
        buildfileにapt-get updateがあるとき、このままだと更新されないので
        --no-cacheを付けることでキャッシュを無効化し全ての命令を実行する

  21.Docker Hubへのイメージのプッシュ方法
    → プッシュ リポジトリのイメージを追加すること

    $ docker login
      → Docker Hubへログインするコマンド
    
    Docker Hubにおけるタグ付けルール
      <Docker ID>/<イメージ名>:<タグ名>
        → タグ名は省略したらlatest

    $ docker tag docker-whale okogejunya/docker-whale:ver1
      → イメージをプッシュするためにタグ付けルールに乗っ取った名前に変更

    $ docker push <Docker ID>/<イメージ名>:<タグ名>
      → Docker HubにPushする際のコマンド

    $ docker pull <Docker ID>/<イメージ名>:<タグ名>
      → イメージへのアクセス権限があるDocker Hubのユーザーアカウントがあれば
        どこからでもイメージを取得できるようになった


  23.nginxコンテナの実行とデタッチドモードの解説

    nginxイメージのExposing extermal portに書いてあるコマンド⤵️
    $ docker run --name some-nginx -d -p 8080:80 some-content-nginx
    $ docker run --name <コンテナ名> -d -p <ホスト側のポート番号>:<コンテナ側のポート番号> <イメージ名>
      → --name <コンテナ名> 起動時のコンテナに名前をつけるオプション
      → -d デタッチドモード コンテナの実行をバックグラウンドで行うもの
        これがないとフォアグラウンドで実行され、ターミナルが止まり他の操作ができなくなる
      → -p <ホスト側のポート番号>:<コンテナ側のポート番号>
        コンテナのポートをコンテナ外に公開する設定
        ホストの8080に繋げばコンテナの80のnginxに繋がる

    $ docker stop test-nginx
    $ docker rm test-nginx



    24.バインドマウントの解説
      ホスト側のディレクトリをコンテナにマウントする

      Hosting some simple static contentに書いてあるコマンド
      $ docker run --name some-nginx -v /some/content:/usr/share/nginx/html:ro -d nginx
        -v <ホスト側のディレクトリ>:<コンテナ側のマウントポイント>:<オプション>  が追加
          → -v 静的なコンテンツをnginxで公開する 
          → :ro read only
          → 絶対パスで指定する

      $ mkdir docker-tutrial
      $ cd docker-tutrial
      $ mkdir html
      $ cd html

      $ vim index.html

      $ docker run --name first-nginx -v /Users/wadajunya/imagebuild/docker-tutrial/html:/usr/share/nginx/html:ro -d -p 8080:80 nginx
        これでホスト上のディレクトリをnginx上で公開できるようになった